@model WebApplication1.Models.Dtos.UserDto
@using WebApplication1.Models.Dtos

@{
    var districts = ViewBag.Districts as List<string> ?? new List<string>();
    var allRegions = ViewBag.Regions as List<RegionDto> ?? new List<RegionDto>();
}


@{
    ViewData["Title"] = "Thêm Người Dùng";
}

<h2>@ViewData["Title"]</h2>

<form asp-area="Admin" asp-controller="User" asp-action="Create" method="post">
    <div class="mb-3">
        <label class="form-label">Họ tên</label>
        <input asp-for="FullName" class="form-control" />
    </div>

    <div class="mb-3">
        <label class="form-label">Email</label>
        <input asp-for="Email" type="email" class="form-control" />
    </div>

    <div class="mb-3">
        <label class="form-label">Mật khẩu</label>
        <input asp-for="Password" type="password" class="form-control" />
    </div>

    <div class="mb-3">
        <label class="form-label">Số điện thoại</label>
        <input asp-for="PhoneNumber" class="form-control" />
    </div>

    <div class="mb-3">
        <label class="form-label">CCCD</label>
        <input asp-for="CCCD" class="form-control" />
    </div>

    <div class="mb-3">
        <label>Chọn Quận/Huyện</label>
        <select id="districtSelect" name="District" class="form-control">
            <option value="">-- Chọn Quận/Huyện --</option>
            @foreach (var d in districts)
            {
                <option value="@d">@d</option>
            }
        </select>
    </div>

    <!-- Chọn Phường/Xã -->
    <div class="mb-3">
        <label>Chọn Phường/Xã</label>
        <select id="wardSelect" name="Ward" class="form-control">
            <option value="">-- Chọn Phường/Xã --</option>
        </select>
    </div>

    <div class="mb-3">
        <label class="form-label">Vai trò</label>
        <select asp-for="Role" class="form-control">
            <option value="User">User</option>
            <option value="Leader">Leader</option>
            <option value="Admin">Admin</option>
        </select>
    </div>

    <button type="submit" class="btn btn-primary">Lưu</button>
    <a asp-area="Admin" asp-controller="User" asp-action="Index" class="btn btn-secondary">Hủy</a>
</form>
@section Scripts {
    <script>
        const regions = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(allRegions));

        console.log("Regions:", regions); // Kiểm tra xem có log ra không

        document.addEventListener("DOMContentLoaded", function () {
            const districtSelect = document.getElementById("districtSelect");
            const wardSelect = document.getElementById("wardSelect");

            districtSelect.addEventListener("change", function () {
                const selectedDistrict = this.value;
                wardSelect.innerHTML = '<option value="">-- Chọn Phường/Xã --</option>';

                regions.filter(r => r.District === selectedDistrict)
                       .forEach(r => {
                           const opt = document.createElement("option");
                           opt.value = r.Ward;
                           opt.textContent = r.Ward;
                           wardSelect.appendChild(opt);
                       });
            });
        });
    </script>
}

